<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>happynewyear</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; cursor: pointer; font-family: 'Segoe UI', Tahoma, sans-serif; }
        canvas { display: block; }
        #heart-text {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #00d4ff; font-size: 2.2rem; font-weight: bold;
            text-shadow: 0 0 20px #00d4ff; opacity: 0;
            transition: opacity 2s ease; pointer-events: none; z-index: 10;
        }
        #heart-text.show { opacity: 0.7; animation: pulse 2s infinite; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 5, 15, 0.98); display: flex; justify-content: center;
            align-items: center; color: #d0d0d0; opacity: 0; visibility: hidden;
            transition: 3s ease; z-index: 100;
        }
        #overlay.active { opacity: 1; visibility: visible; }
        .typewriter { font-size: 1.2rem; line-height: 1.8; border-left: 2px solid #00d4ff; padding: 10px 25px; max-width: 85%; }
        .cursor { display: inline-block; width: 6px; height: 18px; background: #00d4ff; animation: blink 0.8s infinite; vertical-align: middle; }
        @keyframes pulse { 0%, 100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.05); } }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    </style>
</head>
<body>

<audio id="bgMusic" loop>
    <source src="nhac.mp3" type="audio/mpeg">
</audio>

<div id="heart-text">I LOVE YOU...</div>
<canvas id="canvas"></canvas>

<div id="overlay">
    <div class="typewriter"><span id="text"></span><span class="cursor"></span></div>
</div>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const music = document.getElementById('bgMusic');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let rockets = [], particles = [], heartPoints = [], phase = 'firing', timer = 0;

function initHeart() {
    for (let t = 0; t < Math.PI * 2; t += 0.02) {
        const r = 14;
        const x = r * 16 * Math.pow(Math.sin(t), 3);
        const y = -r * (13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t));
        heartPoints.push({ x: x + canvas.width/2, y: y + canvas.height/2 - 40 });
    }
}

class Rocket {
    constructor() {
        this.x = Math.random() * (canvas.width - 200) + 100;
        this.y = canvas.height;
        this.targetY = Math.random() * (canvas.height * 0.45);
        this.speed = Math.random() * 1.5 + 4; // Tốc độ bay chậm da diết
        this.color = `hsl(${Math.random() * 20 + 190}, 80%, 70%)`;
        this.exploded = false;
    }
    update() {
        this.y -= this.speed;
        if (this.y <= this.targetY) { this.exploded = true; explode(this.x, this.y, this.color); }
    }
    draw() { ctx.fillStyle = this.color; ctx.beginPath(); ctx.arc(this.x, this.y, 1.2, 0, Math.PI * 2); ctx.fill(); }
}

class Particle {
    constructor(x, y, color, target = null) {
        this.x = x; this.y = y; this.color = color;
        this.size = Math.random() * 1.5 + 0.3;
        this.vx = (Math.random() - 0.5) * 6;
        this.vy = (Math.random() - 0.5) * 6;
        this.target = target;
        this.friction = 0.98;
    }
    update() {
        if (phase === 'firing') {
            this.x += this.vx; this.y += this.vy;
            this.vx *= this.friction; this.vy *= this.friction;
            this.vy += 0.02; 
        } else {
            if (this.target) {
                this.x += (this.target.x - this.x) * 0.025;
                this.y += (this.target.y - this.y) * 0.025;
            }
        }
    }
    draw() { ctx.fillStyle = this.color; ctx.globalAlpha = 0.6; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); }
}

function explode(x, y, color) {
    for (let i = 0; i < 55; i++) {
        const target = heartPoints[Math.floor(Math.random() * heartPoints.length)];
        particles.push(new Particle(x, y, color, target));
    }
}

function typeWriter(text, i) {
    if (i < text.length) {
        document.getElementById("text").innerHTML += text.charAt(i);
        let speed = 80;
        if (text[i] === '.' || text[i] === '!') speed = 1000;
        if (text[i] === ',') speed = 500;
        setTimeout(() => typeWriter(text, i + 1), speed);
    }
}

function animate() {
    ctx.fillStyle = 'rgba(0, 3, 12, 0.25)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    timer++;
    if (phase === 'firing' && timer % 40 === 0 && timer < 240) rockets.push(new Rocket());
    if (timer === 360) {
        phase = 'converging';
        setTimeout(() => document.getElementById('heart-text').classList.add('show'), 1500);
    }
    rockets = rockets.filter(r => !r.exploded);
    rockets.forEach(r => { r.update(); r.draw(); });
    particles.forEach(p => { p.update(); p.draw(); });
    requestAnimationFrame(animate);
}

window.addEventListener('click', () => {
    if (phase === 'converging') {
        music.play();
        const overlay = document.getElementById('overlay');
        if(!overlay.classList.contains('active')) {
            overlay.classList.add('active');
            const msg = "Chúc mừng năm mới 2026! Pháo hoa đêm nay rực rỡ thật, nhưng lòng tớ lại trĩu nặng vì biết ngày cậu chuyển đi đã cận kề.\n\nTớ hối hận vì đã giấu kín tình cảm này quá lâu, để đến lúc sắp mất đi cơ hội gặp cậu mỗi ngày mới đủ can đảm để nói ra: Tớ thích cậu, thích rất nhiều. Cậu là người hoạt bát, năng động và tỏa sáng nhất mà tớ từng biết.\n\nCó lẽ sự hiện diện của tớ trong những tháng qua chỉ là lướt qua đời cậu, nhưng với tớ, cậu là cả một thanh xuân. Chúc cậu hạnh phúc và mãi rạng rỡ ở nơi mới nhé. Tạm biệt cậu...";
            setTimeout(() => typeWriter(msg, 0), 1500);
        }
    }
});

initHeart();
animate();
</script>
</body>
</html>